<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>Keepalived：Nginx高可用的实现及抢占式与非抢占模式详解</title>
      <link href="/2024/08/12/keepalived/"/>
      <url>/2024/08/12/keepalived/</url>
      
        <content type="html"><![CDATA[<h1 id="Keepalived：Nginx高可用的实现及抢占式与非抢占模式详解"><a href="#Keepalived：Nginx高可用的实现及抢占式与非抢占模式详解" class="headerlink" title="Keepalived：Nginx高可用的实现及抢占式与非抢占模式详解"></a>Keepalived：Nginx高可用的实现及抢占式与非抢占模式详解</h1><h2 id="1-简介"><a href="#1-简介" class="headerlink" title="1. 简介"></a>1. 简介</h2><p>Keepalived 是一种用于实现高可用性的工具，通过提供虚拟 IP（VIP），允许两个或多个服务器共享同一个 IP 地址，当一台服务器故障时，另一台服务器可以立即接管，确保服务的持续可用性。</p><h2 id="2-Keepalived-安装"><a href="#2-Keepalived-安装" class="headerlink" title="2. Keepalived 安装"></a>2. Keepalived 安装</h2><p>在 CentOS&#x2F;RHEL 系统上，可以通过以下命令安装 Keepalived：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> yum install keepalived -y</span><br></pre></td></tr></table></figure><h2 id="3-Keepalived抢占式配置"><a href="#3-Keepalived抢占式配置" class="headerlink" title="3. Keepalived抢占式配置"></a>3. Keepalived抢占式配置</h2><h3 id="3-1-Keepalived抢占式MASTER配置"><a href="#3-1-Keepalived抢占式MASTER配置" class="headerlink" title="3.1 Keepalived抢占式MASTER配置"></a>3.1 Keepalived抢占式MASTER配置</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">vrrp_script chk_nginx &#123;</span><br><span class="line">  script <span class="string">&quot;/usr/local/bin/check_nginx.sh&quot;</span></span><br><span class="line">  interval 2</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">vrrp_instance VI_1 &#123;</span><br><span class="line">  state MASTER</span><br><span class="line">  interface eth0</span><br><span class="line">  virtual_router_id 51</span><br><span class="line">  priority 100</span><br><span class="line">  advert_int 1</span><br><span class="line">  authentication &#123;</span><br><span class="line">    auth_type PASS</span><br><span class="line">    auth_pass 12345</span><br><span class="line">  &#125;</span><br><span class="line">  virtual_ipaddress &#123;</span><br><span class="line">    192.168.0.100</span><br><span class="line">  &#125;</span><br><span class="line">  track_script &#123;</span><br><span class="line">    chk_nginx</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment"># 默认抢占模式，不需要额外设置</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="3-2-Keepalived抢占式BACKUP配置"><a href="#3-2-Keepalived抢占式BACKUP配置" class="headerlink" title="3.2 Keepalived抢占式BACKUP配置"></a>3.2 Keepalived抢占式BACKUP配置</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">vrrp_script chk_nginx &#123;</span><br><span class="line">  script <span class="string">&quot;/usr/local/bin/check_nginx.sh&quot;</span></span><br><span class="line">  interval 2</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">vrrp_instance VI_1 &#123;</span><br><span class="line">  state BACKUP</span><br><span class="line">  interface eth0</span><br><span class="line">  virtual_router_id 51</span><br><span class="line">  priority 90</span><br><span class="line">  advert_int 1</span><br><span class="line">  authentication &#123;</span><br><span class="line">    auth_type PASS</span><br><span class="line">    auth_pass 12345</span><br><span class="line">  &#125;</span><br><span class="line">  virtual_ipaddress &#123;</span><br><span class="line">    192.168.0.100</span><br><span class="line">  &#125;</span><br><span class="line">  track_script &#123;</span><br><span class="line">    chk_nginx</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment"># 默认抢占模式，不需要额外设置</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="4-Keepalived非抢占式配置"><a href="#4-Keepalived非抢占式配置" class="headerlink" title="4 Keepalived非抢占式配置"></a>4 Keepalived非抢占式配置</h2><h2 id="4-1-Keepalived非抢占式MASTER配置"><a href="#4-1-Keepalived非抢占式MASTER配置" class="headerlink" title="4.1 Keepalived非抢占式MASTER配置"></a>4.1 Keepalived非抢占式MASTER配置</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">vrrp_instance VI_1 &#123;</span><br><span class="line">  state BACKUP</span><br><span class="line">  interface eth0</span><br><span class="line">  virtual_router_id 51</span><br><span class="line">  priority 100</span><br><span class="line">  advert_int 1</span><br><span class="line">  authentication &#123;</span><br><span class="line">    auth_type PASS</span><br><span class="line">    auth_pass 12345</span><br><span class="line">  &#125;</span><br><span class="line">  virtual_ipaddress &#123;</span><br><span class="line">    192.168.0.100</span><br><span class="line">  &#125;</span><br><span class="line">  nopreempt  <span class="comment"># 禁用抢占模式</span></span><br><span class="line">  track_script &#123;</span><br><span class="line">    chk_nginx</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="4-2-Keepalived非抢占式BACKUP配置"><a href="#4-2-Keepalived非抢占式BACKUP配置" class="headerlink" title="4.2 Keepalived非抢占式BACKUP配置"></a>4.2 Keepalived非抢占式BACKUP配置</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">vrrp_instance VI_1 &#123;</span><br><span class="line">  state BACKUP</span><br><span class="line">  interface eth0</span><br><span class="line">  virtual_router_id 51</span><br><span class="line">  priority 90</span><br><span class="line">  advert_int 1</span><br><span class="line">  authentication &#123;</span><br><span class="line">    auth_type PASS</span><br><span class="line">    auth_pass 12345</span><br><span class="line">  &#125;</span><br><span class="line">  virtual_ipaddress &#123;</span><br><span class="line">    192.168.0.100</span><br><span class="line">  &#125;</span><br><span class="line">  nopreempt  <span class="comment"># 禁用抢占模式</span></span><br><span class="line">  track_script &#123;</span><br><span class="line">    chk_nginx</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="5-启用并启动-Keepalived"><a href="#5-启用并启动-Keepalived" class="headerlink" title="5. 启用并启动 Keepalived"></a>5. 启用并启动 Keepalived</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> systemctl start keepalived</span><br><span class="line"><span class="built_in">sudo</span> systemctl <span class="built_in">enable</span> keepalived</span><br></pre></td></tr></table></figure><h2 id="6-测试配置"><a href="#6-测试配置" class="headerlink" title="6. 测试配置"></a>6. 测试配置</h2><h3 id="6-1-故障转移测试"><a href="#6-1-故障转移测试" class="headerlink" title="6.1 故障转移测试"></a>6.1 故障转移测试</h3><p>   在主节点上停止 Nginx：sudo systemctl stop nginx。<br>   检查 VIP 是否转移到备用节点。</p><h3 id="6-2-恢复测试"><a href="#6-2-恢复测试" class="headerlink" title="6.2 恢复测试"></a>6.2 恢复测试</h3><p>   重新启动主节点上的 Nginx：sudo systemctl start nginx。<br>   检查 VIP 是否回到主节点（针对抢占模式）。</p><h2 id="7-结论"><a href="#7-结论" class="headerlink" title="7. 结论"></a>7. 结论</h2><p>   通过 Keepalived，您可以实现高可用的 Nginx 集群。在抢占式模式下，主节点恢复后会重新获得 VIP，而在非抢占模式下，VIP 将继续保持在备节点，直到其停止运行。根据业务需求选择合适的模式，确保系统的高可用性和稳定性。</p>]]></content>
      
      
      <categories>
          
          <category> 基础设施 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Keepalived </tag>
            
            <tag> Nginx </tag>
            
            <tag> 高可用性 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Hello World</title>
      <link href="/2024/08/06/hello-world/"/>
      <url>/2024/08/06/hello-world/</url>
      
        <content type="html"><![CDATA[<p>Welcome to <a href="https://hexo.io/">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues">GitHub</a>.</p><h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new <span class="string">&quot;My New Post&quot;</span></span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/writing.html">Writing</a></p><h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/server.html">Server</a></p><h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/generating.html">Generating</a></p><h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/one-command-deployment.html">Deployment</a></p>]]></content>
      
      
      
    </entry>
    
    
  
  
</search>
